<!DOCTYPE html>  <html> <head>   <title>handler.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="user.html">                 user.coffee               </a>                                           <a class="source" href="handler.html">                 handler.coffee               </a>                                           <a class="source" href="passport-helpers.html">                 passport-helpers.coffee               </a>                                           <a class="source" href="server.html">                 server.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               handler.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="nv">ensureAuthenticated = </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./passport-helpers&quot;</span><span class="p">).</span><span class="nx">ensureAuthenticated</span>
<span class="nv">passport = </span><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;./passport-helpers&quot;</span><span class="p">).</span><span class="nx">passport</span>

<span class="nv">exports.routes = </span><span class="nf">(app) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>=============</h2>

<p>Get Handling   #</p>

<h2>=============</h2>

<p>Check if user is already authenticated.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">app</span><span class="p">.</span><span class="nx">get</span> <span class="s2">&quot;/&quot;</span><span class="p">,</span> <span class="nx">ensureAuthenticated</span><span class="p">,</span> <span class="nf">(req, res) -&gt;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span> <span class="s2">&quot;index&quot;</span><span class="p">,</span>
      <span class="nv">user: </span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Login and register From getter</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">app</span><span class="p">.</span><span class="nx">get</span> <span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="nf">(req, res) -&gt;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span> <span class="s2">&quot;login&quot;</span><span class="p">,</span> <span class="p">{}</span>

  <span class="nx">app</span><span class="p">.</span><span class="nx">get</span> <span class="s2">&quot;/register&quot;</span><span class="p">,</span> <span class="nf">(req, res) -&gt;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span> <span class="s2">&quot;register&quot;</span><span class="p">,</span> <span class="p">{}</span>

  <span class="nx">app</span><span class="p">.</span><span class="nx">get</span> <span class="s2">&quot;/account&quot;</span><span class="p">,</span> <span class="nx">ensureAuthenticated</span><span class="p">,</span> <span class="nf">(req, res) -&gt;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span> <span class="s2">&quot;account&quot;</span><span class="p">,</span>
      <span class="nv">user: </span><span class="nx">req</span><span class="p">.</span><span class="nx">user</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Log-out function</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">app</span><span class="p">.</span><span class="nx">get</span> <span class="s2">&quot;/logout&quot;</span><span class="p">,</span> <span class="nf">(req, res) -&gt;</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">logout</span><span class="p">()</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span> <span class="s2">&quot;/&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h2>=============</h2>

<p>Post Handling   #</p>

<h2>=============</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">app</span><span class="p">.</span><span class="nx">post</span> <span class="s2">&quot;/register&quot;</span><span class="p">,</span> <span class="nf">(req, res) -&gt;</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">render</span> <span class="s2">&quot;register.jade&quot;</span><span class="p">,</span> <span class="p">{}</span>
    <span class="nv">name = </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">name</span>
    <span class="nv">email = </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">email</span>
    <span class="nv">pass = </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">pass</span>
    <span class="nv">cpass = </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">cpass</span>
    <span class="nv">gender = </span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">gender</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>POST /login
  Use passport.authenticate() as route middleware to authenticate the request. 
  If authentication fails, the user will be redirected back to the login page.
  Otherwise, the user is redirected to his personal home page
  which, in this example, will redirect the user to the home page.</p>

<p>curl -v -d "username=bob&amp;password=secret" http:#127.0.0.1:3000/login</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">app</span><span class="p">.</span><span class="nx">post</span> <span class="s2">&quot;/login&quot;</span><span class="p">,</span> <span class="nf">(req, res, next) -&gt;</span>
    <span class="nx">passport</span><span class="p">.</span><span class="nx">authenticate</span><span class="p">(</span><span class="s2">&quot;local&quot;</span><span class="p">,</span> <span class="nf">(err, user, info) -&gt;</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">err</span>
      <span class="nx">unless</span> <span class="nx">user</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>user is not authenticated, redirect to /login</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">req</span><span class="p">.</span><span class="nx">flash</span> <span class="s2">&quot;error&quot;</span><span class="p">,</span> <span class="nx">info</span><span class="p">.</span><span class="nx">message</span>
        <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span><span class="p">(</span><span class="s2">&quot;/login&quot;</span><span class="p">)</span>
      <span class="nx">req</span><span class="p">.</span><span class="nx">logIn</span> <span class="nx">user</span><span class="p">,</span> <span class="nf">(err) -&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>user is authenticated, redirect to /users/user.username</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span>  <span class="k">if</span> <span class="nx">err</span>
        <span class="nx">res</span><span class="p">.</span><span class="nx">redirect</span> <span class="s2">&quot;/users/&quot;</span> <span class="o">+</span> <span class="nx">user</span><span class="p">.</span><span class="nx">username</span>
    <span class="p">)</span> <span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">,</span> <span class="nx">next</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 